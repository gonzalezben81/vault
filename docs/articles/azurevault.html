<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="vault">
<title>Azure &amp; Vault â€¢ vault</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Azure &amp; Vault">
<meta property="og:description" content="vault">
<meta property="og:image" content="https://gonzalezben81.github.io/vault/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="pkgdown.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-S6MW51TT6K"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-S6MW51TT6K');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">vault</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/vault.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/awscftemplates.html">AWS &amp; Vault CloudFormation Templates</a>
    <a class="dropdown-item" href="../articles/awsvault.html">AWS &amp; Vault</a>
    <a class="dropdown-item" href="../articles/azurevault.html">Azure &amp; Vault</a>
    <a class="dropdown-item" href="../articles/github.html">GitHub &amp; Vault</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/gonzalezben81/vault/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Azure &amp; Vault</h1>
                        <h4 data-toc-skip class="author">Ben
Gonzalez</h4>
            
            <h4 data-toc-skip class="date">2024-07-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/gonzalezben81/vault/blob/HEAD/vignettes/azurevault.Rmd" class="external-link"><code>vignettes/azurevault.Rmd</code></a></small>
      <div class="d-none name"><code>azurevault.Rmd</code></div>
    </div>

    
    
<div class="section level4">
<h4 id="creates-azure-resources">Creates Azure Resources<a class="anchor" aria-label="anchor" href="#creates-azure-resources"></a>
</h4>
<p>Before you configure the Azure auth method in Vault you will want to
setup an App Registration in Azure. This is where you will provide the
callback URLs when authenticating via the Azure OIDC method.</p>
</div>
<div class="section level4">
<h4 id="enable-the-oidc-auth-method">Enable the OIDC auth method<a class="anchor" aria-label="anchor" href="#enable-the-oidc-auth-method"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">vault</span> auth enable oidc</span></code></pre></div>
<p>Check to see if the vault auth oidc method has been enabled.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">vault</span> auth list</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="setup-the-oidc-configuration-for-azure-in-vault">Setup the OIDC configuration for Azure in Vault<a class="anchor" aria-label="anchor" href="#setup-the-oidc-configuration-for-azure-in-vault"></a>
</h4>
<p>Next you will want to setup the oidc configuration for Azure in
Vault. You will want to do this via the Vault CLI, preferrably as the
root token user</p>
<ul>
<li>oidc_discover_url: the URL of your Azure tenant</li>
<li>oidc_client_id: client id from your Azure tenant</li>
<li>oidc_client_secret: client secret from your Azure tenant</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">vault</span> write auth/oidc/config <span class="dt">\</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    oidc_discovery_url=<span class="st">"https://login.microsoftonline.com/&lt;azure-tenant-id&gt;/v2.0"</span> <span class="dt">\</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    oidc_client_id=<span class="st">"&lt;azure-client-id&gt;"</span> <span class="dt">\</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    oidc_client_secret=<span class="st">"&lt;azure-secret&gt;"</span> <span class="dt">\</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    default_role=<span class="st">"azure-developers"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="setup-azure-role-that-will-authenticate-with-vault">Setup Azure role that will authenticate with Vault<a class="anchor" aria-label="anchor" href="#setup-azure-role-that-will-authenticate-with-vault"></a>
</h4>
<p>Here you will want to create the Azure role that will authenticate
between Azure and Vault for you.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">vault</span> write auth/oidc/role/azure-developers <span class="dt">\</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    user_claim=<span class="st">"email"</span> <span class="dt">\</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    groups_claim=<span class="st">"groups"</span> <span class="dt">\</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    role_type=<span class="st">"oidc"</span> <span class="dt">\</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    oidc_scopes=<span class="st">"https://graph.microsoft.com/.default"</span> <span class="dt">\</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    allowed_redirect_uris=<span class="st">""</span>http://localhost:8250/oidc/callback<span class="st">",https://&lt;url-redirect &gt;/ui/vault/auth/oidc/oidc/callback"</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    <span class="va">policies</span><span class="op">=</span><span class="st">"azure-developers"</span> <span class="dt">\</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    <span class="va">ttl</span><span class="op">=</span>1h  </span></code></pre></div>
</div>
<div class="section level4">
<h4 id="test-the-azure-oidc-login-method">Test the Azure OIDC login method<a class="anchor" aria-label="anchor" href="#test-the-azure-oidc-login-method"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">vault</span> login <span class="at">-method</span><span class="op">=</span>oidc</span></code></pre></div>
<hr>
<p>References</p>
<p><a href="https://developer.hashicorp.com/vault/tutorials/auth-methods/oidc-auth-azure" class="external-link">Azure
Vault Tutorial</a></p>
<p><a href="https://learn.microsoft.com/en-us/entra/identity-platform/quickstart-create-new-tenant" class="external-link">Azure
Tenant Setup</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://rgonzo.com" class="external-link">Ben Gonzalez</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
