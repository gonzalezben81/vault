<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="vault">
<title>AWS &amp; Vault â€¢ vault</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="AWS &amp; Vault">
<meta property="og:description" content="vault">
<meta property="og:image" content="https://gonzalezben81.github.io/vault/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="pkgdown.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-S6MW51TT6K"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-S6MW51TT6K');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">vault</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/vault.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/awsvault.html">AWS &amp; Vault</a>
    <a class="dropdown-item" href="../articles/azurevault.html">Azure &amp; Vault</a>
    <a class="dropdown-item" href="../articles/github.html">GitHub &amp; Vault</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/gonzalezben81/vault/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>AWS &amp; Vault</h1>
                        <h4 data-toc-skip class="author">Ben
Gonzalez</h4>
            
            <h4 data-toc-skip class="date">2024-07-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/gonzalezben81/vault/blob/HEAD/vignettes/awsvault.Rmd" class="external-link"><code>vignettes/awsvault.Rmd</code></a></small>
      <div class="d-none name"><code>awsvault.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="creates-aws-resources">Creates AWS Resources<a class="anchor" aria-label="anchor" href="#creates-aws-resources"></a>
</h3>
<p>Before you configure the HCP Vault AWS auth method, you must create
the necessary resources in AWS. The AWS auth method will require an IAM
policy that permits the appropriate access for the auth method, an IAM
user with programmatic access, and one or more roles that you will
assign to other AWS services that require authentication to Vault.</p>
</div>
<div class="section level3">
<h3 id="create-iam-policy">Create IAM Policy<a class="anchor" aria-label="anchor" href="#create-iam-policy"></a>
</h3>
<p>You will now create the IAM policy for your IAM User</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="dt">"Version"</span><span class="fu">:</span> <span class="st">"2012-10-17"</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="dt">"Statement"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a> <span class="fu">{</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>   <span class="dt">"Effect"</span><span class="fu">:</span> <span class="st">"Allow"</span><span class="fu">,</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>   <span class="dt">"Action"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>     <span class="st">"ec2:DescribeInstances"</span><span class="ot">,</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>     <span class="st">"iam:GetInstanceProfile"</span><span class="ot">,</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>     <span class="st">"iam:GetUser"</span><span class="ot">,</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>     <span class="st">"iam:ListRoles"</span><span class="ot">,</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>     <span class="st">"iam:GetRole"</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>   <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>   <span class="dt">"Resource"</span><span class="fu">:</span> <span class="st">"*"</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a> <span class="fu">}</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a> <span class="ot">]</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="fu">}</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-connection-to-vault-via-aws-iam-user">Create connection to Vault via AWS IAM User<a class="anchor" aria-label="anchor" href="#create-connection-to-vault-via-aws-iam-user"></a>
</h3>
<p>Enable aws auth on your vault instance.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">vault</span> auth enable aws</span></code></pre></div>
<p>Check to see if the vault auth aws method has been enabled.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">vault</span> auth list</span></code></pre></div>
<p>Next connect the IAM role you created in AWS to the Vault aws auth
backend. This will configure the AWS auth method with access to your AWS
account using the Access key ID and Secret Access Key previously created
for the IAM User you created in AWS.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">vault</span> write auth/aws/config/client secret_key=<span class="op">&lt;</span>secret-key<span class="op">&gt;</span> access_key=<span class="op">&lt;</span>access-key<span class="op">&gt;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-vault-role-for-connection-to-aws-iam-role">Create Vault role for connection to AWS IAM Role<a class="anchor" aria-label="anchor" href="#create-vault-role-for-connection-to-aws-iam-role"></a>
</h3>
<p>Configure the AWS auth method to trust the AWS IAM role previously
created and attach the vault-policy-for-aws-ec2role to the token
provided by the AWS auth method. Replace <iam-arn> with the actual IAM
Role ARN you created in AWS.</iam-arn></p>
<p><strong>Note: The IAM User Arn will look like the following:
arn:aws:iam::&lt;aws-account-number&gt;:user/vaultauth </strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">vault</span> write auth/aws/role/vault-role-for-aws-ec2role <span class="dt">\</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>     auth_type=iam <span class="dt">\</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>     bound_iam_principal_arn=<span class="op">&lt;</span>iam-arn<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>     policies=default,allinonepolicy</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">vault</span> write auth/approle/role/vault-role-for-aws-ec2role <span class="dt">\</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>    secret_id_ttl=10m <span class="dt">\</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    token_num_uses=0 <span class="dt">\</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    token_ttl=20m <span class="dt">\</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    token_max_ttl=30m <span class="dt">\</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    secret_id_num_uses=40</span></code></pre></div>
<p>List the roles you creates for the aws auth method</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">vault</span> list /auth/aws/role</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">vault</span> write auth/aws/role/vaultauth auth_type=iam <span class="dt">\</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>              bound_iam_principal_arn=<span class="op">&lt;</span>iam-arn<span class="op">&gt;</span> policies=default,allinonepolicy max_ttl=500h</span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://rgonzo.com" class="external-link">Ben Gonzalez</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
